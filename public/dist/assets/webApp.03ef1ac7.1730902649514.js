import{aT as e,a4 as a,r as s,V as n,a as t,M as l,b as i,c,d,n as r,m as o,j as u,i as m,g as p,F as v,f,I as y,v as x,J as _,h as g,s as k,x as b,k as h,aU as w,T as C,X as z,aP as I}from"./index.34872ab0.1730902649514.js";import{M as j}from"./dialog.226123aa.1730902649514.js";import{b as T}from"./app.7e4ab096.1730902649514.js";import"./sortable.esm.c2baa127.1730902649514.js";import"./index.ba2374e6.1730902649514.js";import"./wangEditor.c4e29644.1730902649514.js";const B={class:"manager-webApp p-0 rounded-lg"},S={class:"card-swipe"},A={class:"card-swipe-item"},M={class:"ml-auto localInstallCard"},$={class:"p-4 mt-4 bg-white rounded-lg h-full webappItem overflow-hidden"},L={key:1,class:"card-box"},U={key:0,class:"card-box-item"},E={class:"flex"},F=["src"],H={class:"ml-6 flex-1"},J={class:"flex justify-between"},P={class:"text-base"},V={class:"text-sm mt-2 text-gray-500"},X={class:"flex mt-4"},q={key:0,class:"card-box-item superBgCArd flex flex-col items-center"},D={class:"card-box"},G={key:0,class:"card-box-item"},K={class:"flex"},N=["src"],O={class:"ml-6 flex-1"},Q={class:"flex justify-between"},R={class:"text-base"},W={class:"text-sm mt-2 text-gray-500"},Y={class:"flex mt-4"},Z={__name:"webApp",setup(Z){const ee=e(),ae=a(),se=s(!0),ne=s(0),te=e=>{ne.value=e},le=s([]),ie=s([]),ce=e=>{var a;return null==(a=ie.value.find((a=>a.name_en===e)))?void 0:a.status},de=()=>{n({url:"/admin.Index/localCard"}).then((e=>{1===e.code&&(ie.value=e.data),se.value=!1}))};de(),n({url:"/admin.Index/cardList"}).then((e=>{1===e.code&&(le.value=e.data)}));const re=async e=>{await n({url:"/admin.Index/stopCard",method:"post",data:{name_en:e.name_en}}),de()},oe=async e=>{try{await n({url:"/admin.Index/startCard",method:"post",data:{name_en:e.name_en}})}catch(a){}de()},ue=e=>{const a=le.value.find((a=>a.name_en===e.name_en));if(a&&a.version>e.version)return!0};return(e,a)=>{const s=t("el-empty"),Z=t("el-tag"),me=t("el-button"),pe=l("loading");return i(),c("div",B,[d("div",S,[d("div",A,[d("button",{class:r({selSwipe:0===ne.value}),onClick:a[0]||(a[0]=e=>te(0))},"官方小组件",2),d("button",{class:r({selSwipe:1===ne.value}),onClick:a[1]||(a[1]=e=>te(1))},"外部小组件",2),o("",!0)]),d("div",M,[d("button",{id:"localInstallCard",onClick:a[3]||(a[3]=()=>{u(_).warning("暂时不开放此功能，待完善后开放")})},"本地上传安装组件")])]),m((i(),c("div",$,[m(d("div",null,[se.value||0!==ie.value.length?o("",!0):(i(),p(s,{key:0,description:"快去卡片商店安装卡片组件吧！"})),se.value?o("",!0):(i(),c("div",L,[(i(!0),c(v,null,f(u(T),((e,s)=>(i(),p(C,{key:s},{default:g((()=>[ie.value.find((a=>a.name_en===e.name_en))&&(!1===e.auth||e.auth&&u(k).state.auth)?(i(),c("div",U,[d("div",E,[d("img",{class:"card-box-item-logo",src:e.src,alt:""},null,8,F),d("div",H,[d("div",J,[d("div",P,[d("span",null,b(e.name),1),h(Z,{round:"",class:"ml-4",type:1===ce(e.name_en)?"primary":"warning"},{default:g((()=>[y(b(1===ce(e.name_en)?"已启用":"已关闭"),1)])),_:2},1032,["type"])]),e.setting?(i(),p(me,{key:0,round:"",size:"small",rounded:"",type:"primary",onClick:a=>(e=>{ae.value=e.setting,ee.push({path:"/manager/appSetting/"+e.name_en})})(e)},{default:g((()=>a[4]||(a[4]=[y("设置 ")]))),_:2},1032,["onClick"])):o("",!0)]),d("div",V,b(e.tips),1)])]),d("div",X,[h(Z,{type:"danger",class:"mr-3"},{default:g((()=>{return[y("热度："+b(u(w)((a=e.name_en,null==(s=ie.value.find((e=>e.name_en===a)))?void 0:s.install_num))),1)];var a,s})),_:2},1024),h(Z,{class:"mr-3",type:"warning"},{default:g((()=>[y("标识："+b(e.name_en),1)])),_:2},1024),ce(e.name_en)?(i(),p(me,{key:0,size:"small",type:"info",onClick:a=>re(e)},{default:g((()=>a[5]||(a[5]=[y("停止使用 ")]))),_:2},1032,["onClick"])):o("",!0),ce(e.name_en)?o("",!0):(i(),p(me,{key:1,size:"small",type:"success",onClick:a=>oe(e)},{default:g((()=>a[6]||(a[6]=[y(" 开启访问 ")]))),_:2},1032,["onClick"]))])])):o("",!0)])),_:2},1024)))),128)),u(k).state.auth?o("",!0):(i(),c("div",q,a[7]||(a[7]=[d("div",{class:"text-center"},[d("b",{class:"text-xl"},"为了程序可持续发展"),d("br"),y("更多小组件获取订阅后自动解锁。 ")],-1),d("a",{href:"https://mtab.cc/pricing.html",target:"_blank",class:"mt-4 text-xs p-2 px-6 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full text-white"},"获取订阅授权解锁更多功能",-1)])))]))],512),[[x,0===ne.value]]),m(d("div",null,[se.value||0!==ie.value.length?o("",!0):(i(),p(s,{key:0,description:"快去卡片商店安装卡片组件吧！"})),d("div",D,[(i(!0),c(v,null,f(ie.value,((e,s)=>(i(),p(C,{key:s},{default:g((()=>[u(T)[e.name_en]?o("",!0):(i(),c("div",G,[d("div",K,[d("img",{class:"card-box-item-logo",src:e.src,alt:""},null,8,N),d("div",O,[d("div",Q,[d("div",R,[d("span",null,b(e.name),1),1===e.status?(i(),p(Z,{key:0,round:"",class:"ml-4"},{default:g((()=>a[8]||(a[8]=[y(" 已启用 ")]))),_:1})):o("",!0),0===e.status?(i(),p(Z,{key:1,round:"",class:"ml-4",type:"warning"},{default:g((()=>a[9]||(a[9]=[y(" 已关闭 ")]))),_:1})):o("",!0)]),ue(e)?(i(),p(me,{key:0,onClick:a=>(async(e,a="install")=>{if("update"===a)try{const a=le.value.find((a=>a.name_en===e.name_en));a&&await z.confirm(`\n              <div>\n                <pre style="white-space: pre-line;">\n                  ${a.commit}\n                </pre>\n              </div>\n              `,`本次版本更新内容（${a.name}：v${a.version}）`,{dangerouslyUseHTMLString:!0,confirmButtonText:"确定更新"})}catch(t){return void _.info("已取消更新")}const s=I.service({fullscreen:!0,text:"安装中很快就好，请耐心等待···"});n({url:"/admin.Index/installCard",method:"post",data:{type:a,name_en:e.name_en}}).then((e=>{1===e.code?(_.success(e.msg),de()):_.error(e.msg)})).finally((e=>{s.close()}))})(e,"update"),type:"primary",size:"small",class:"rounded-full"},{default:g((()=>a[10]||(a[10]=[d("span",null,"更新版本",-1)]))),_:2},1032,["onClick"])):(null==e?void 0:e.setting)?(i(),p(me,{key:1,size:"small",round:"",style:{"background-color":"#2980b9",border:"1px solid #2980b9"},rounded:"",type:"warning",onClick:a=>(e=>{new j({title:e.name+"- 参数配置",ico:e.src,url:e.setting,custom:{minimization:0,maximize:0}}).open()})(e)},{default:g((()=>a[11]||(a[11]=[y("设置 ")]))),_:2},1032,["onClick"])):o("",!0)]),d("div",W,b(e.tips),1)])]),d("div",Y,[h(Z,{type:"danger",class:"mr-3"},{default:g((()=>[y("热度："+b(u(w)(e.install_num)),1)])),_:2},1024),h(Z,{class:"mr-3"},{default:g((()=>[y("版本：v"+b(e.version),1)])),_:2},1024),e.status?(i(),p(me,{key:0,size:"small",type:"info",onClick:a=>re(e)},{default:g((()=>a[12]||(a[12]=[y("停止使用")]))),_:2},1032,["onClick"])):o("",!0),e.status?o("",!0):(i(),p(me,{key:1,size:"small",type:"success",onClick:a=>oe(e)},{default:g((()=>a[13]||(a[13]=[y("开启访问")]))),_:2},1032,["onClick"])),u(T)[e.name_en]?o("",!0):(i(),p(me,{key:2,size:"small",type:"danger",onClick:a=>(async e=>{try{await z.confirm("您即将删除当前插件，请谨慎操作！","危险警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning","custom-style":{width:"500px"}})}catch(t){return!1}await re(e);const a=I.service({fullscreen:!0,text:"很快就好，请耐心等待···"}),s=await n({url:"/admin.Index/uninstallCard",method:"post",data:{name_en:e.name_en}});1===s.code&&(_.success(s.msg),de()),a.close()})(e)},{default:g((()=>a[14]||(a[14]=[y("卸载 ")]))),_:2},1032,["onClick"]))])]))])),_:2},1024)))),128))])],512),[[x,1===ne.value]]),o("",!0)])),[[pe,se.value]])])}}};export{Z as default};

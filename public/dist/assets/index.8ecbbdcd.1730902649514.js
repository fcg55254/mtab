import{_ as e,r as l,A as a,a as s,b as d,c as t,d as u,I as r,i as o,v as i,k as p,h as n,V as m,j as _,aG as c,x as b,aH as f,J as g}from"./index.34872ab0.1730902649514.js";const v={class:"installPage"},y={class:"install-item"},h={class:"flex gap-x-4"},V={class:"flex w-full justify-between"},w={class:"install-item"},x={class:"flex gap-x-4"},q={class:"flex w-full justify-between"},k={class:"install-item"};var U=e({__name:"index",setup(e){const U=l(),z=l(),C=l(!1),j=l(!1),F=l(1),I=a({db_host:"",db_port:3306,db_username:"",db_password:"",table_name:"",admin_email:"",admin_password:"",database_type:1}),R=a({db_host:[{required:!0,message:"数据库地址不能为空",trigger:"blur"}],db_port:[{required:!0,message:"数据库端口不能为空",trigger:"blur"}],db_username:[{required:!0,message:"数据库用户名不能为空",trigger:"blur"}],db_password:[{required:!0,message:"数据库密码不能为空",trigger:"blur"}],table_name:[{required:!0,message:"数据库表名不能为空",trigger:"blur"}]}),A=a({admin_email:[{required:!0,message:"管理员账号不能为空",trigger:"blur"}],admin_password:[{required:!0,message:"管理员密码不能为空",trigger:"blur"}]}),D=async()=>{const e=await m({url:"/install.php?s=/testDb",method:"post",data:I});200===e.code?(g.success(e.msg),j.value=!0):(j.value=!1,g.error(e.msg))},G=l({php_version:!1,fileinfo_ext:!1,mysqli_ext:!1,zip_ext:!1,curl_ext:!1});(async()=>{const e=await m({url:"/install.php?s=/ext",method:"get",data:I});200===e.code&&(G.value=e.data)})();return(e,l)=>{const a=s("el-input"),H=s("el-form-item"),J=s("el-input-number"),L=s("el-button"),P=s("el-form"),T=s("el-option"),B=s("el-select"),E=s("el-tag"),K=s("el-result");return d(),t("div",v,[l[20]||(l[20]=u("div",{class:"installLogo"},[u("img",{src:"/dist/assets/favicon.d0d9e2c4.1730902649514.png"}),u("h1",null,[u("span",{style:{color:"#ff7e05"}},"m"),r("Tab新标签页安装程序")])],-1)),o(u("div",y,[p(P,{model:I,rules:R,ref_key:"FormRef",ref:U,size:"large","label-position":"top"},{default:n((()=>[u("div",h,[p(H,{class:"w-full",prop:"db_host",label:"数据库地址"},{default:n((()=>[p(a,{modelValue:I.db_host,"onUpdate:modelValue":l[0]||(l[0]=e=>I.db_host=e),placeholder:"请输入数据库地址"},null,8,["modelValue"])])),_:1}),p(H,{style:{width:"150px","flex-shrink":"0"},prop:"db_port",label:"数据库端口"},{default:n((()=>[p(J,{modelValue:I.db_port,"onUpdate:modelValue":l[1]||(l[1]=e=>I.db_port=e),style:{width:"100%"},placeholder:"端口号"},null,8,["modelValue"])])),_:1})]),p(H,{prop:"db_username",label:"数据库用户名"},{default:n((()=>[p(a,{modelValue:I.db_username,"onUpdate:modelValue":l[2]||(l[2]=e=>I.db_username=e),placeholder:"请输入数据库用户名"},null,8,["modelValue"])])),_:1}),p(H,{prop:"db_password",label:"数据库用户密码"},{default:n((()=>[p(a,{modelValue:I.db_password,"onUpdate:modelValue":l[3]||(l[3]=e=>I.db_password=e),placeholder:"请输入数据库用户密码"},null,8,["modelValue"])])),_:1}),p(H,{prop:"table_name",label:"数据库名称"},{default:n((()=>[p(a,{modelValue:I.table_name,"onUpdate:modelValue":l[4]||(l[4]=e=>I.table_name=e),placeholder:"请输入需要连接/创建的数据库名称"},null,8,["modelValue"])])),_:1}),p(H,null,{default:n((()=>[u("div",V,[p(L,{class:"w-full",onClick:D,type:j.value?"success":"danger",icon:j.value?_(c):""},{default:n((()=>[r(b(j.value?"连接成功":"测试连接"),1)])),_:1},8,["type","icon"]),p(L,{onClick:l[5]||(l[5]=e=>(async e=>{await e.validate(((e,l)=>{e&&(F.value=2)}))})(U.value)),type:"primary"},{default:n((()=>l[12]||(l[12]=[r("下一步")]))),_:1})])])),_:1})])),_:1},8,["model","rules"])],512),[[i,1===F.value]]),o(u("div",w,[p(P,{model:I,rules:1===I.database_type?A:R,ref_key:"FormRef2",ref:z,"label-position":"top",size:"large"},{default:n((()=>[p(H,{label:"安装模式"},{default:n((()=>[p(B,{modelValue:I.database_type,"onUpdate:modelValue":l[6]||(l[6]=e=>I.database_type=e)},{default:n((()=>[p(T,{label:"全新安装",value:1}),p(T,{label:"仅安装程序",value:2})])),_:1},8,["modelValue"])])),_:1}),p(H,{prop:"admin_email",label:"管理员账号"},{default:n((()=>[p(a,{disabled:2===I.database_type,modelValue:I.admin_email,"onUpdate:modelValue":l[7]||(l[7]=e=>I.admin_email=e),placeholder:"请输入默认管理员邮箱账号"},null,8,["disabled","modelValue"])])),_:1}),p(H,{prop:"admin_password",label:"管理员密码"},{default:n((()=>[p(a,{disabled:2===I.database_type,modelValue:I.admin_password,"onUpdate:modelValue":l[8]||(l[8]=e=>I.admin_password=e),placeholder:"请输入默认管理员账号密码"},null,8,["disabled","modelValue"])])),_:1}),p(H,{label:"必备扩展是否安装"},{default:n((()=>[u("div",x,[p(E,{type:G.value.php_version?"success":"danger"},{default:n((()=>l[13]||(l[13]=[r("php>=7.4")]))),_:1},8,["type"]),p(E,{type:G.value.fileinfo_ext?"success":"danger"},{default:n((()=>l[14]||(l[14]=[r("fileinfo")]))),_:1},8,["type"]),p(E,{type:G.value.mysqli_ext?"success":"danger"},{default:n((()=>l[15]||(l[15]=[r("mysqli")]))),_:1},8,["type"]),p(E,{type:G.value.zip_ext?"success":"danger"},{default:n((()=>l[16]||(l[16]=[r("zip")]))),_:1},8,["type"]),p(E,{type:G.value.curl_ext?"success":"danger"},{default:n((()=>l[17]||(l[17]=[r("curl")]))),_:1},8,["type"])])])),_:1}),p(H,null,{default:n((()=>[u("div",q,[p(L,{onClick:l[9]||(l[9]=e=>F.value=1),type:"primary"},{default:n((()=>l[18]||(l[18]=[r("上一步")]))),_:1}),p(L,{class:"w-full",onClick:l[10]||(l[10]=e=>(async e=>{await e.validate((async(e,l)=>{if(e){C.value=!0;const e=await m({url:"/install.php?s=/install",method:"post",data:I});200===e.code?(g.success(e.msg),F.value=3):(j.value=!1,g.error(e.msg)),C.value=!1}}))})(z.value)),loading:C.value,type:"success"},{default:n((()=>[r(b(C.value?"正在安装，请耐心等待":"开始安装"),1)])),_:1},8,["loading"])])])),_:1})])),_:1},8,["model","rules"])],512),[[i,2===F.value]]),o(u("div",k,[p(K,{icon:"success",title:"安装完成","sub-title":"请点击前往首页开始使用程序吧"},{extra:n((()=>[p(L,{onClick:l[11]||(l[11]=()=>{_(f).push({path:"/"})}),type:"primary"},{default:n((()=>l[19]||(l[19]=[r(" 前往首页 ")]))),_:1})])),_:1})],512),[[i,3===F.value]])])}}},[["__scopeId","data-v-44013c76"]]);export{U as default};

import{_ as e}from"./defavatar.fe9b13f3.1730902649514.js";import{r as l,a,b as t,c as u,d as o,k as d,h as n,V as r,I as s,j as i,q as p,g as m,m as c,X as g,J as v}from"./index.34872ab0.1730902649514.js";import{_ as f}from"./el-input-upload.104cbfc3.1730902649514.js";const h={class:"userManager"},_={class:"p-4 bg-white rounded-lg overflow-hidden flex flex-wrap gap-4"},w={class:"mt-4 flex gap-x-4"},b={class:"bg-white p-4 rounded-lg overflow-hidden w-full"},V=["src"],y={key:1,class:"rounded-full m-auto",src:e,style:{width:"40px",height:"40px"}},k={class:"grid grid-cols-2 grid-rows-subgrid gap-y-2 gap-x-2"},x={__name:"oAuth",setup(e){const x={mail:"",password:"",manager:0,nickname:"",status:0};l(!1);const C=l(Object.assign({},x)),z=l(!1);l([]);const U=l({mail:"",nickname:""}),j=()=>{C.value=l({mail:"",password:"",manager:""}).value,z.value=!0},P=()=>{r({url:"/admin/userUpdate",method:"post",data:C.value}).then((e=>{1===e.code&&(z.value=!1,O()),v.success(e.msg)}))},A=l({current_page:1,per_page:50,total:0,refresh(e){A.value.current_page=e,O()},sizes(e){A.value.per_page=e,O()}}),I=l([]),D={order:"desc",prop:"id"},O=()=>{r({url:"/admin/UserList",method:"post",data:{search:U.value,page:A.value.current_page,limit:A.value.per_page,sort:D}}).then((e=>{let l=e.data;I.value=l.data,Object.assign(A.value,l)}))},S=({column:e,prop:l,order:a})=>{let t="asc";"descending"===a&&(t="desc"),D.order=t,D.prop=l,O()};return(e,l)=>{const D=a("el-input"),q=a("el-button"),E=a("el-table-column"),J=a("el-tag"),K=a("el-table"),L=a("el-pagination"),M=a("el-form-item"),X=a("el-option"),Y=a("el-select"),B=a("el-form"),F=a("el-link"),G=a("el-drawer");return t(),u("div",h,[o("div",_,[d(D,{modelValue:U.value.mail,"onUpdate:modelValue":l[0]||(l[0]=e=>U.value.mail=e),style:{width:"200px"},placeholder:"APPID",clearable:""},null,8,["modelValue"]),d(D,{modelValue:U.value.nickname,"onUpdate:modelValue":l[1]||(l[1]=e=>U.value.nickname=e),style:{width:"200px"},placeholder:"应用名称",clearable:""},null,8,["modelValue"]),d(q,{onClick:O,type:"primary"},{default:n((()=>l[13]||(l[13]=[s("搜索")]))),_:1}),d(q,{type:"danger",onClick:j},{default:n((()=>l[14]||(l[14]=[s("添加应用")]))),_:1})]),o("div",w,[o("div",b,[d(K,{onSortChange:S,data:I.value,height:"calc(100vh - 200px)"},{default:n((()=>[d(E,{prop:"id",sortable:"custom",label:"APPID",align:"center","min-width":"100"}),d(E,{prop:"avatar",label:"应用图标",align:"center","min-width":"70"},{default:n((e=>[e.row.avatar?(t(),u("img",{key:0,class:"rounded-full m-auto",src:i(p)(e.row.avatar),style:{width:"40px",height:"40px"}},null,8,V)):(t(),u("img",y))])),_:1}),d(E,{prop:"nickname","show-overflow-tooltip":"",label:"应用名称",align:"center","min-width":"200"}),d(E,{prop:"mail",label:"APPKEY",align:"center","min-width":"200"}),d(E,{prop:"login_ip",label:"白名单IP",align:"center","min-width":"200"}),d(E,{prop:"manager",label:"应用状态",align:"center","min-width":"100"},{default:n((e=>[0===e.row.status?(t(),m(J,{key:0,type:"info",size:"large"},{default:n((()=>l[15]||(l[15]=[s("正常")]))),_:1})):c("",!0),1===e.row.status?(t(),m(J,{key:1,type:"danger",size:"large"},{default:n((()=>l[16]||(l[16]=[s("冻结封锁")]))),_:1})):c("",!0)])),_:1}),d(E,{prop:"manager",label:"权限",align:"center","min-width":"100"},{default:n((e=>l[17]||(l[17]=[]))),_:1}),d(E,{fixed:"right",label:"操作","min-width":"200",align:"center"},{default:n((e=>[o("div",k,[d(q,{type:"primary",onClick:l=>{return a=e.row,C.value=Object.assign({},x,a),void(z.value=!0);var a},class:"w-full",style:{"margin-left":"0"},size:"small"},{default:n((()=>l[18]||(l[18]=[s(" 修改 ")]))),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"]),d(L,{"page-sizes":[15,20,30,40,50,100],onCurrentChange:A.value.refresh,class:"mt-6",layout:"sizes,total,prev,pager,jumper","page-size":A.value.per_page,onSizeChange:A.value.sizes,total:A.value.total},null,8,["onCurrentChange","page-size","onSizeChange","total"])])]),d(G,{title:"编辑用户",modelValue:z.value,"onUpdate:modelValue":l[12]||(l[12]=e=>z.value=e),size:500,"align-center":"","close-on-click-modal":!1},{default:n((()=>[d(B,{modelValue:C.value,"onUpdate:modelValue":l[10]||(l[10]=e=>C.value=e),"label-width":"100px","label-position":"top"},{default:n((()=>[d(M,{label:"头像"},{default:n((()=>[d(f,{modelValue:C.value.avatar,"onUpdate:modelValue":l[2]||(l[2]=e=>C.value.avatar=e),placeholder:"请设置头像"},null,8,["modelValue"])])),_:1}),d(M,{label:"邮箱"},{default:n((()=>[d(D,{modelValue:C.value.mail,"onUpdate:modelValue":l[3]||(l[3]=e=>C.value.mail=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),d(M,{label:"昵称"},{default:n((()=>[d(D,{modelValue:C.value.nickname,"onUpdate:modelValue":l[4]||(l[4]=e=>C.value.nickname=e),placeholder:"设置昵称"},null,8,["modelValue"])])),_:1}),d(M,{label:"设置密码"},{default:n((()=>[d(D,{modelValue:C.value.password,"onUpdate:modelValue":l[5]||(l[5]=e=>C.value.password=e),placeholder:"请设置新密码,否则请留空"},null,8,["modelValue"])])),_:1}),d(M,{label:"状态"},{default:n((()=>[d(Y,{modelValue:C.value.status,"onUpdate:modelValue":l[6]||(l[6]=e=>C.value.status=e),class:"w-full",placeholder:"请选择用户状态"},{default:n((()=>[d(X,{label:"正常",value:0}),d(X,{label:"冻结",value:1})])),_:1},8,["modelValue"])])),_:1}),d(M,{label:"是否管理员"},{default:n((()=>[d(Y,{modelValue:C.value.manager,"onUpdate:modelValue":l[7]||(l[7]=e=>C.value.manager=e),class:"w-full",placeholder:"请选择"},{default:n((()=>[d(X,{label:"用户",value:0}),d(X,{label:"管理员",value:1})])),_:1},8,["modelValue"])])),_:1}),d(M,{label:"登录失败次数"},{default:n((()=>[d(D,{modelValue:C.value.login_fail_count,"onUpdate:modelValue":l[9]||(l[9]=e=>C.value.login_fail_count=e),class:"w-full"},{append:n((()=>[d(q,{onClick:l[8]||(l[8]=e=>{C.value.login_fail_count=0})},{default:n((()=>l[19]||(l[19]=[s("重置")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"]),d(q,{class:"mt-4 w-full",onClick:P,type:"primary",size:"large"},{default:n((()=>l[20]||(l[20]=[s("提交")]))),_:1}),C.value.id?(t(),m(F,{key:0,class:"mt-6",type:"danger",onClick:l[11]||(l[11]=e=>(async e=>{try{await g.confirm("您确定删除当前用户？删除后数据将全部删除！","危险操作警告"),1===(await r({url:"/admin/userDelete",method:"post",data:{id:e}})).code&&(v.success("已删除当前用户所有数据"),z.value=!1,O())}catch(l){v.info("操作已取消")}})(C.value.id))},{default:n((()=>l[21]||(l[21]=[s("删除用户")]))),_:1})):c("",!0)])),_:1},8,["modelValue"])])}}};export{x as default};
